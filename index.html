<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; margin: 0; padding: 50px; background: linear-gradient(to right, #e0f7fa, #ffffff); color: #333; }
        h2 { color: #00796b; margin-bottom: 30px; font-size: 40px; text-shadow: 1px 1px 3px rgba(0,0,0,0.1); }
        #location-input { font-size: 24px; padding: 15px; width: 350px; border: 2px solid #00796b; border-radius: 25px; transition: border-color 0.3s, box-shadow 0.3s; outline: none; }
        #location-input:focus { border-color: #004d40; box-shadow: 0 0 5px rgba(0, 77, 64, 0.6); }
        button { font-size: 24px; padding: 15px 30px; margin-left: 10px; border: none; background-color: #00796b; color: white; border-radius: 25px; cursor: pointer; transition: background-color 0.3s, transform 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        button:hover { background-color: #004d40; transform: scale(1.05); }
        #weather-info, #forecast-info { margin-top: 30px; font-size: 20px; color: #555; padding: 20px; border: 2px solid #00796b; border-radius: 10px; background-color: #ffffff; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 400px; margin-left: auto; margin-right: auto; transition: transform 0.3s; }
        #weather-info:hover, #forecast-info:hover { transform: scale(1.02); }
        #loading { display: none; font-size: 20px; color: #007bff; margin-top: 10px; position: relative; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #00796b; border-radius: 50%; width: 40px; height: 40px; animation: spin 0.8s linear infinite; display: inline-block; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #loading { animation: glow 1s infinite alternate; }
        @keyframes glow { from { text-shadow: 0 0 5px #00796b, 0 0 10px #00796b; } to { text-shadow: 0 0 10px #00796b, 0 0 20px #00796b; } }
    </style>
</head>
<body>

<h2>SOOBY WEATHER</h2>
<input type="text" id="location-input" placeholder="Enter city, country">
<button onclick="searchWeather()">Search</button>
<div id="loading" style="display:none;">Loading...<div class="loader"></div></div>
<div id="weather-info"></div>
<div id="forecast-info"></div>

<script>
const apiKey = 'f3e93f9ddcf28e1e66b6a8117bd1f123'; // Keep your API key in a constant

// Automatically get user's location
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        displayMessage("Geolocation is not supported by this browser.");
    }
}

function showPosition(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    fetchWeatherByCoordinates(lat, lon);
}

function showError(error) {
    switch (error.code) {
        case error.PERMISSION_DENIED:
            displayMessage("User denied the request for Geolocation.");
            break;
        case error.POSITION_UNAVAILABLE:
            displayMessage("Location information is unavailable.");
            break;
        case error.TIMEOUT:
            displayMessage("The request to get user location timed out.");
            break;
        case error.UNKNOWN_ERROR:
            displayMessage("An unknown error occurred.");
            break;
    }
}

// Fetch weather by coordinates
function fetchWeatherByCoordinates(lat, lon) {
    document.getElementById("loading").style.display = "flex"; // Show loading text
    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}`)
        .then(response => {
            document.getElementById("loading").style.display = "none"; // Hide loading text
            if (!response.ok) {
                throw new Error('Failed to fetch weather data.');
            }
            return response.json();
        })
        .then(data => {
            const tempC = (data.main.temp - 273.15).toFixed(2);
            const tempF = ((tempC * 9 / 5) + 32).toFixed(2);
            const humidity = data.main.humidity;
            const windSpeed = data.wind.speed;
            const sunrise = new Date(data.sys.sunrise * 1000).toLocaleTimeString();
            const sunset = new Date(data.sys.sunset * 1000).toLocaleTimeString();
            displayWeather(data.name, data.sys.country, tempC, tempF, data.weather[0].description, humidity, windSpeed, sunrise, sunset);
            fetchForecast(lat, lon); // Fetch forecast using coordinates
        })
        .catch(error => {
            console.error('Error fetching weather data:', error);
            displayMessage(error.message);
        });
}

// Fetch weather based on input
function searchWeather() {
    const locationInput = document.getElementById("location-input").value.trim();
    const [city, country] = locationInput.split(',').map(item => item.trim());

    if (!city || !country) {
        displayMessage("Please enter both the city and the country.");
        return;
    }

    document.getElementById("loading").style.display = "flex"; // Show loading text
    fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},${country}&appid=${apiKey}`)
        .then(response => {
            document.getElementById("loading").style.display = "none"; // Hide loading text
            if (!response.ok) {
                throw new Error('Wrong city, please try again.'); // Update the error message
            }
            return response.json();
        })
        .then(data => {
            const tempC = (data.main.temp - 273.15).toFixed(2);
            const tempF = ((tempC * 9 / 5) + 32).toFixed(2); // Convert Celsius to Fahrenheit
            const humidity = data.main.humidity;
            const windSpeed = data.wind.speed;
            const sunrise = new Date(data.sys.sunrise * 1000).toLocaleTimeString();
            const sunset = new Date(data.sys.sunset * 1000).toLocaleTimeString();
            displayWeather(data.name, data.sys.country, tempC, tempF, data.weather[0].description, humidity, windSpeed, sunrise, sunset);
            fetchForecast(data.coord.lat, data.coord.lon); // Fetch forecast using coordinates
        })
        .catch(error => {
            console.error('Error fetching weather data:', error);
            displayMessage(error.message);
        });
}

// Display weather data
function displayWeather(city, country, tempC, tempF, condition, humidity, windSpeed, sunrise, sunset) {
    const weatherInfo = document.getElementById("weather-info");
    weatherInfo.innerHTML = `Weather in ${city}, ${country}: <br> Temperature: ${tempC}°C / ${tempF}°F <br> Condition: ${condition} <br> Humidity: ${humidity}% <br> Wind Speed: ${windSpeed} m/s <br> Sunrise: ${sunrise} <br> Sunset: ${sunset}`;
}

//